
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Using compressed assets in LibRocket via PhysicsFS - Martin Foot</title>
  <meta name="author" content="Martin Foot">

  
  <meta name="description" content="LibRocket is a system that allows you to define user interface elements for OpenGL/DirectX applications in HTML and CSS. As well as being easy to get &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mfoo.github.com/blog/2011/09/04/using-compressed-assets-in-librocket-via-physicsfs/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Martin Foot" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Martin Foot</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mfoo.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Using Compressed Assets in LibRocket via PhysicsFS</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-04T10:37:45+01:00" pubdate data-updated="true">Sep 4<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><a href="librocket.com">LibRocket</a> is a system that allows you to define user interface elements for OpenGL/DirectX applications in HTML and CSS. As well as being easy to get started with and powerful, this is really useful as it means you can load UI elements from files that can be edited without needing to recompile the application. It provides several interface classes that you can customise based on your current platform to allow it to play nice with any other libraries you may be using.</p>

<p>I&#8217;ve been storing compressed project assets using <a href="icculus.org/physfs/">PhysicsFS</a>, which allows for direct read/write access to compressed files such as zip files. After a little fiddling, I produced the class below that allows LibRocket to read it&#8217;s assets via PhysicsFS.</p>

<p>RocketFileSystemInterface.h:</p>

<p>[code lang=&#8221;cpp&#8221;]</p>

<h1>ifndef <em>ROCKETFILESYSTEMINTERFACE_H</em></h1>

<h1>define <em>ROCKETFILESYSTEMINTERFACE_H</em></h1>

<h1>include &lt;Rocket/Core/FileInterface.h></h1>

<p>/<em>*
 * A FileInterface for libRocket (http://librocket.com/) that enables the
 * reading of files via PhysicsFS (http://icculus.org/physfs/) directly from a
 * compressed archive.
 *
 * Note: The PhysicsFS system must be initialised before this class is used via
 * PHYSFS_init() and any archives must be made searchable via
 * PHYSFS_addToSearchPath().
 *
 * Author: Martin Foot
 * Date: 4th September 2011
 </em>/
namespace Delta {
class RocketFileSystemInterface : public Rocket::Core::FileInterface {</p>

<pre><code>public:
    RocketFileSystemInterface();
    ~RocketFileSystemInterface();

    /**
     * Get a read only filehandle to the specified file.
     * @param path  The filename in the compressed archive.
     * @return A Rocket filehandle to the opened file. This can be NULL on
     * failure.
     */
    Rocket::Core::FileHandle Open(const Rocket::Core::String&amp; path);

    /**
     * Close a previously opened file.
     * @param file  The Rocket filehandle to close.
     */
    void Close(Rocket::Core::FileHandle file);

    /**
     * Attempt to read the specified number of bytes into the provided
     * buffer. If the specified number of bytes is greater than the size of
     * the file, only  bytes will be copied.
     * @param buffer    The buffer to read into.
     * @param size  The number of bytes to read.
     * @param file  The Rocket filehandle.
     * @return  The actual number of bytes that was read into the buffer.
     */
    size_t Read(void* buffer, size_t size, Rocket::Core::FileHandle file);

    /**
     * Seek to a point in the previously opened file.
     * @param file  The Rocket filehandle.
     * @param offset    The number of bytes to seek to relative to the
     * supplied origin.
     * @param   One of SEEK_SET (seek relative to the beginning of the file),
     * SEEK_CUR (seek relative to the current position in the file) or
     * SEEK_END (relative to the end of the file).
     * @return  Whether seeking was a success or not.
     */
    bool Seek(Rocket::Core::FileHandle file, long offset, int origin);

    /**
     * Get the length of the file.
     * @param file  The Rocket filehandle.
     * @return  The size in bytes of the file.
     */
    size_t Length(Rocket::Core::FileHandle file);

    /**
     * Get the current read pointer offset.
     * @param file  The Rocket filehandle.
     * @return  The current offset. Returns 0 on failure.
     */
    size_t Tell(Rocket::Core::FileHandle file);
};
</code></pre>

<p>}</p>

<h1>endif // <em>ROCKETFILESYSTEMINTERFACE_H</em></h1>

<p>[/code]</p>

<p>RocketFileSystemInterface.cpp:</p>

<p>[sourcecode language=&#8221;cpp&#8221;]</p>

<h1>include &#8220;RocketFileSystemInterface.h&#8221;</h1>

<h1>include &lt;Rocket/Core.h></h1>

<h1>include &lt;Rocket/Core/Types.h></h1>

<h1>include &lt;physfs.h></h1>

<h1>include <cstdio></h1>

<h1>include <string></h1>

<h1>include &#8220;FileSystemInterface.h&#8221;</h1>

<p>using Delta::FileSystemInterface;</p>

<p>namespace Delta {</p>

<p>RocketFileSystemInterface::RocketFileSystemInterface() : FileInterface() {};</p>

<p>RocketFileSystemInterface::~RocketFileSystemInterface() {};</p>

<p>Rocket::Core::FileHandle RocketFileSystemInterface::Open(const Rocket::Core::String&amp; path) {</p>

<pre><code>if (!PHYSFS_exists(path.CString())) {
    return NULL;
}

PHYSFS_file* file = PHYSFS_openRead(path.CString());
return static_cast&lt;PHYSFS_file*&gt;((uintptr_t)file);
</code></pre>

<p>}</p>

<p>void RocketFileSystemInterface::Close(Rocket::Core::FileHandle file) {</p>

<pre><code>PHYSFS_close(static_cast&lt;PHYSFS_file*&gt;((void *)file));
</code></pre>

<p>}</p>

<p>size_t RocketFileSystemInterface::Read(void* buffer, size_t size, Rocket::Core::FileHandle file) {</p>

<pre><code>PHYSFS_file* ptr = static_cast&lt;PHYSFS_file*&gt;((void *) file);

// Don't read past the end of the file or PhysicsFS will return an error.
size_t length = PHYSFS_fileLength(ptr);
if(size &gt; length) {
    size = length;
}

size_t read = PHYSFS_read(ptr, buffer, size, 1);

return read * size;
</code></pre>

<p>}</p>

<p>bool RocketFileSystemInterface::Seek(Rocket::Core::FileHandle file, long offset, int origin) {</p>

<pre><code>PHYSFS_file* ptr = static_cast&lt;PHYSFS_file*&gt;((void *)file);

int response = 0;

switch(origin) {
    case SEEK_SET:
        // Seek from the beginning of the file.
        response = PHYSFS_seek(ptr, offset);
        break;
    case SEEK_CUR:
        // Offset from the current position.
        response = PHYSFS_seek(ptr, offset + PHYSFS_tell(ptr));
        break;
    case SEEK_END:
        response = PHYSFS_seek(ptr, PHYSFS_fileLength(ptr));
        break;
}

if(response == 0)
    return false;

return true;
</code></pre>

<p>}</p>

<p>size_t RocketFileSystemInterface::Tell(Rocket::Core::FileHandle file) {</p>

<pre><code>PHYSFS_file* ptr = static_cast&lt;PHYSFS_file*&gt;((void *)file);
size_t offset = PHYSFS_tell(ptr);
return offset;
</code></pre>

<p>}</p>

<p>size_t RocketFileSystemInterface::Length(Rocket::Core::FileHandle file) {</p>

<pre><code>PHYSFS_file* ptr = static_cast&lt;PHYSFS_file*&gt;((void *)file);
return PHYSFS_fileLength(ptr);
</code></pre>

<p>}</p>

<p>}
[/sourcecode]</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Martin Foot</span></span>

      








  


<time datetime="2011-09-04T10:37:45+01:00" pubdate data-updated="true">Sep 4<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/game-development/'>Game Development</a>, <a class='category' href='/blog/categories/programming/'>Programming</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://mfoo.github.com/blog/2011/09/04/using-compressed-assets-in-librocket-via-physicsfs/" data-via="martinfoot" data-counturl="http://mfoo.github.com/blog/2011/09/04/using-compressed-assets-in-librocket-via-physicsfs/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/07/17/sending-photos-to-a-python-web-server-with-android/" title="Previous Post: Sending photos to a Python web server with Android">&laquo; Sending photos to a Python web server with Android</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/12/02/adding-tab-completion-to-git-commands-in-bash/" title="Next Post: Adding tab-completion to Git commands in Bash">Adding tab-completion to Git commands in Bash &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/01/01/introduction-to-genetics-and-evolution/">Introduction to Genetics and Evolution</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/01/vim-precision-editing-at-the-speed-of-thought/">Vim - precision editing at the speed of thought</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/26/custom-rake-tasks-for-dbdrop-dbcreate-dbmigrate-dbseed/">Custom Rake Tasks for db:drop db:create db:migrate db:seed</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/26/a-simple-lindenmayer-system-renderer/">A Simple Lindenmayer System Renderer</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/04/22/conways-game-of-life-in-coffeescript/">Conway's Game of Life in CoffeeScript</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/mfoo">@mfoo</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mfoo',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("martinfoot", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/martinfoot" class="twitter-follow-button" data-show-count="false">Follow @martinfoot</a>
  
</section>


<section>
  <h1>Stack Overflow</h1>
  <a href="http://stackoverflow.com/users/825879/martinfoot"><img src="http://stackoverflow.com/users/flair/825879.png" width="208" height="58" alt="profile for martinfoot at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for martinfoot at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
</a>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Martin Foot -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
